# MockForMe + Next.js (CSR + SSR) Integration

### Step 1. Install NextJs
```
npx create-next-app@latest mockforme-nextjs
```

### Step 2. Run Application
```npm
npm run dev
```
Access page: [http://localhost:3000](http://localhost:3000)

### Step 3. Install the package with YARN or NPM
```
yarn add mockforme -D
```
```
npm i mockforme --save-dev
```

### Step 4. Create `.env` file and add `mockforme` Access Token
`NEXT_PUBLIC_MFM_API_TOKEN`=ADD_ACCESS_TOKEN_HERE

Get Access Token from [MockForMe Access Token](https://dashboard.mockforme.com/user/token)

### Step 5. Client Setup
#### Create a new file at [`src/app/mockforme-client.js`](https://github.com/mockformedev/mockforme-nextjs/blob/master/src/app/mockforme-client.js) to set up client-side initialization.
> **Note:** Add `"use client";` at the very top of the file to ensure it runs in the client environment.
```
"use client"

import { mockforme } from "mockforme";

const TOKEN = process.env.NEXT_PUBLIC_MFM_API_TOKEN;

mockforme(TOKEN).run((apis, rules) => {
  console.log("Mocked Apis", apis);
  console.log("Mocked Rules", rules);
}, (err) => {
  console.log("MockForMe Error", err);
});
```

### Step 6. SSR Setup
#### Create a new file at [`src/app/mockforme-server.js`](https://github.com/mockformedev/mockforme-nextjs/blob/master/src/app/mockforme-server.js) to set up server-side initialization
- Import the component that uses `mockforme` for client-side rendering (CSR).
- Set up and initialize `mockforme` for server-side rendering (SSR).

```
import { mockforme } from "mockforme/server";

const TOKEN = process.env.NEXT_PUBLIC_MFM_API_TOKEN;

mockforme(TOKEN).run((apiMappings, rules) => {
  console.log("<MockedApis>", apiMappings);
  console.log("<MockedRules>", rules);
}, (err) => {
  console.log("<mockforme error>", err);
});
```

### Step 7. Import `mockforme-client` and `mockforme-server` in layout.js
[`src/app/layout.js`](https://github.com/mockformedev/mockforme-nextjs/blob/master/src/app/layout.js) file.
```
import "./mockforme-client";
import "./mockforme-server";
                
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

export const metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>
        {children}
      </body>
    </html>
  );
}
```

### Step 8. Inside `src/app/page.js` get product data and pass to ProductList component
```
import { ProductList } from "@/app/components/ProductList";

export default async function Product() {
  try {
    const res = await fetch("https://www.myexample.com/products", {
      cache: "no-store",
    });
    const data = await res.json();
    return (
      <div>
        <ProductList initialData={data} />
      </div>
    );
  } catch (err) {
    console.log("<err>", err);
    return <ProductList initialData={[]} />;
  }
}
```

### Run the project
- Add `mockforme` Access Token in `.env` file
- Run command in terminal `yarn install` OR `npm install` inside the project
- Run the project using `yarn dev` OR `npm run dev`
- Visit http://localhost:3000


# JSON Sample Data for APIs
`/products` [Product API JSON data](https://github.com/mockformedev/mockforme-nextjs/blob/master/products.json)

`/cart` [Cart API JSON data](https://github.com/mockformedev/mockforme-nextjs/blob/master/cart.json)

# Key Takeaways
1. No server setup required
2. Works seamlessly with CSR + SSR
3. Speeds up development & testing

## Topics
server-side-api-mocking · ssr-api-mocking · nextjs-ssr · mock-api · mock-server · mockforme
